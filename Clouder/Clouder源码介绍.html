<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>/ | YuXing138</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.8b81741e.js" as="script"><link rel="preload" href="/assets/js/2.ae7b2f73.js" as="script"><link rel="preload" href="/assets/js/1.5784faf9.js" as="script"><link rel="preload" href="/assets/js/23.a3f0a356.js" as="script"><link rel="prefetch" href="/assets/js/10.11cd5bbe.js"><link rel="prefetch" href="/assets/js/11.d6f242fd.js"><link rel="prefetch" href="/assets/js/12.52955fb8.js"><link rel="prefetch" href="/assets/js/13.0171e0e6.js"><link rel="prefetch" href="/assets/js/14.e8630228.js"><link rel="prefetch" href="/assets/js/15.e3fe6a55.js"><link rel="prefetch" href="/assets/js/16.ed16aad5.js"><link rel="prefetch" href="/assets/js/17.9f06ecf6.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.66f6de90.js"><link rel="prefetch" href="/assets/js/20.2e3db1a8.js"><link rel="prefetch" href="/assets/js/21.ce1d45a6.js"><link rel="prefetch" href="/assets/js/22.da4a9ea1.js"><link rel="prefetch" href="/assets/js/24.160d9058.js"><link rel="prefetch" href="/assets/js/25.7ae12a9c.js"><link rel="prefetch" href="/assets/js/26.7a4ce183.js"><link rel="prefetch" href="/assets/js/27.251dedac.js"><link rel="prefetch" href="/assets/js/28.06bc44dc.js"><link rel="prefetch" href="/assets/js/29.d774f429.js"><link rel="prefetch" href="/assets/js/3.e5de98dd.js"><link rel="prefetch" href="/assets/js/30.d9da3fd8.js"><link rel="prefetch" href="/assets/js/31.688edc58.js"><link rel="prefetch" href="/assets/js/32.250a118b.js"><link rel="prefetch" href="/assets/js/33.2564cc00.js"><link rel="prefetch" href="/assets/js/34.582c748e.js"><link rel="prefetch" href="/assets/js/35.e1b685ff.js"><link rel="prefetch" href="/assets/js/36.621719a0.js"><link rel="prefetch" href="/assets/js/37.0b236ba2.js"><link rel="prefetch" href="/assets/js/38.b600f07d.js"><link rel="prefetch" href="/assets/js/39.f69b96d9.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.e504367e.js"><link rel="prefetch" href="/assets/js/41.0edc5816.js"><link rel="prefetch" href="/assets/js/42.058bd418.js"><link rel="prefetch" href="/assets/js/43.e89cf854.js"><link rel="prefetch" href="/assets/js/44.0c7c8f63.js"><link rel="prefetch" href="/assets/js/5.9221cc65.js"><link rel="prefetch" href="/assets/js/6.08529f20.js"><link rel="prefetch" href="/assets/js/7.d6f7c6a1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YuXing138</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Clouder</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Clouder/Clouder.html" class="sidebar-link">Clouder</a></li><li><a href="/Clouder/Clouder源码介绍.html" class="active sidebar-link">Clouder源码介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Clouder/Clouder源码介绍.html#" class="sidebar-link">/</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Clouder/Clouder源码介绍.html#命名规划" class="sidebar-link" style="padding-left:3rem;">命名规划</a></li><li class="sidebar-sub-header"><a href="/Clouder/Clouder源码介绍.html#路径规划" class="sidebar-link" style="padding-left:3rem;">路径规划</a></li><li class="sidebar-sub-header"><a href="/Clouder/Clouder源码介绍.html#错误-异常规划" class="sidebar-link" style="padding-left:3rem;">错误/异常规划</a></li><li class="sidebar-sub-header"><a href="/Clouder/Clouder源码介绍.html#图床规划" class="sidebar-link" style="padding-left:3rem;">图床规划</a></li></ul></li></ul></li><li><a href="/Clouder/怎么开源.html" class="sidebar-link">怎么开源</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id=""><a href="#" class="header-anchor">#</a> /</h2> <h4 id="命名规划"><a href="#命名规划" class="header-anchor">#</a> 命名规划</h4> <blockquote><p>严格区分文件、目录、路径、名称。</p></blockquote> <p>docFile---------表示doc对象（File）<br>docFileDir------表示doc所在目录对象（File）<br>docFilePath-----表示doc路径（String）<br>docFileDirPath--表示doc所在目录路径（String）<br>docFileName-----表示doc名称（String）<br>docFileDirName--表示doc所在目录名称（String）</p> <h4 id="路径规划"><a href="#路径规划" class="header-anchor">#</a> 路径规划</h4> <p>原始文件目录：/upload/<br>临时文件目录：/clouder/temporary/<br>文档本地目录：/clouder/document/<br>图片本地目录：/clouder/picture/<br>页面本地目录：/clouder/page/</p> <h4 id="错误-异常规划"><a href="#错误-异常规划" class="header-anchor">#</a> 错误/异常规划</h4> <p>1、采用具体异常类，比如：拷贝写异常、移动写异常、新增写异常、下载写异常、推送写异常、克隆写异常。<br>2、项目中的异常处理（分层架构）：<br>控制层，不用考虑异常，下图。<br>业务层，需要考虑异常，捕获异常并抛出自定义异常，再统一交给异常工具类评估。<br>工具层，不用考虑异常，直接抛给业务层处理。<br><img src="https://jiq-picture.yuxing138.top/f375bed138e3a9d7cafe99b1e3f4b0ec/1689859183880-f319f1b0-a6fc-4c67-8630-dbd3f4487cf1.png#averageHue=%23c6751c&amp;clientId=ue89c5d7b-711e-4&amp;from=paste&amp;height=900&amp;id=u3bd8aa70&amp;originHeight=1800&amp;originWidth=2880&amp;originalType=binary&amp;ratio=2&amp;rotation=0&amp;showTitle=false&amp;size=441971&amp;status=done&amp;style=none&amp;taskId=u7e300463-29cc-4cf4-9fb5-1705279d450&amp;title=&amp;width=1440" alt="image.png"></p> <h4 id="图床规划"><a href="#图床规划" class="header-anchor">#</a> 图床规划</h4> <p>1、背景：一个文档分配一个图片文件夹；兼容文档重命名时，图片文件夹不变。<br>2、索引的基本架构：使用“哈希桶组”作为一级索引，使用“有序队列”作为二级索引。<br>3、索引的具体实现：<br>使用完整的哈希值作为哈希桶组，长度为2^32(21亿)。如果存放在一个索引文件中，文件过大，还需要对索引进行分层。由于产品的定位不是大型图床，不采用此方案。<br>使用长度为62^3的哈希桶组作为一级索引，每个桶分配62个小桶。大概可容纳1500万个文档，个人文档库一般不超过1万。这样索引文件只有100K，适合个人图床，决定采用此方案。<br>4、怎么避免图片覆盖？</p> <blockquote><p>每个桶只分配62个小桶。如果用户的文档非常多，某个桶的冲突超过62次且文档中的图片名称相同，则会出现图片覆盖。</p></blockquote> <p>（1）通过图片前缀来避免图片覆盖，每次文档重命名都会造成图片浪费，不采用此方案。<br>（2）让用户自行保证图片名称唯一，以避免图片覆盖，不采用此方案。<br>（3）直接限制每个小桶只能存放61个文档的图片（哈希冲突达到61次后提醒），以避免图片覆盖。由于是个人图床，决定采用此方案。<br>5、怎么保证索引文件的原子性？<br>（1）如果要保证两个文件（一级索引index1与二级索引index2）同时写入成功，锁定时间太长。<br>（2）<code>二级索引index2</code>依赖<code>一级索引index1</code>，但多个<code>二级索引index2</code>之间并不相互依赖。因此不用同时锁定两个索引文件，<code>一级索引index1</code>与<code>二级索引index2</code>各自使用一把锁。<br>6、怎么保证文档的一致性？<br>（1）发现异常，写操作需要回滚，读操作无需回滚。<br>（2）每个文档保存一个操作列表用于回滚。<br>（3）文档在回滚的过程中，<code>二级索引index2</code>要锁定。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Clouder/Clouder.html" class="prev">
        Clouder
      </a></span> <span class="next"><a href="/Clouder/怎么开源.html">
        怎么开源
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8b81741e.js" defer></script><script src="/assets/js/2.ae7b2f73.js" defer></script><script src="/assets/js/1.5784faf9.js" defer></script><script src="/assets/js/23.a3f0a356.js" defer></script>
  </body>
</html>
