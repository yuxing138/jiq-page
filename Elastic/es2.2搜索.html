<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>/ | YuXing138</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.ce2a3b87.js" as="script"><link rel="preload" href="/assets/js/2.ae7b2f73.js" as="script"><link rel="preload" href="/assets/js/1.5784faf9.js" as="script"><link rel="preload" href="/assets/js/38.a2dbe0d8.js" as="script"><link rel="prefetch" href="/assets/js/10.11cd5bbe.js"><link rel="prefetch" href="/assets/js/11.d6f242fd.js"><link rel="prefetch" href="/assets/js/12.52955fb8.js"><link rel="prefetch" href="/assets/js/13.0171e0e6.js"><link rel="prefetch" href="/assets/js/14.e8630228.js"><link rel="prefetch" href="/assets/js/15.e3fe6a55.js"><link rel="prefetch" href="/assets/js/16.ed16aad5.js"><link rel="prefetch" href="/assets/js/17.9f06ecf6.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.66f6de90.js"><link rel="prefetch" href="/assets/js/20.2e3db1a8.js"><link rel="prefetch" href="/assets/js/21.ce1d45a6.js"><link rel="prefetch" href="/assets/js/22.da4a9ea1.js"><link rel="prefetch" href="/assets/js/23.a3f0a356.js"><link rel="prefetch" href="/assets/js/24.42e6cfbe.js"><link rel="prefetch" href="/assets/js/25.b196e0e7.js"><link rel="prefetch" href="/assets/js/26.586425fa.js"><link rel="prefetch" href="/assets/js/27.7b2297dc.js"><link rel="prefetch" href="/assets/js/28.ba7851cc.js"><link rel="prefetch" href="/assets/js/29.312e1c22.js"><link rel="prefetch" href="/assets/js/3.e5de98dd.js"><link rel="prefetch" href="/assets/js/30.f4db5fa7.js"><link rel="prefetch" href="/assets/js/31.954bf7eb.js"><link rel="prefetch" href="/assets/js/32.18fd524d.js"><link rel="prefetch" href="/assets/js/33.0644c8ca.js"><link rel="prefetch" href="/assets/js/34.db4f1203.js"><link rel="prefetch" href="/assets/js/35.56598df6.js"><link rel="prefetch" href="/assets/js/36.3ecb7c25.js"><link rel="prefetch" href="/assets/js/37.efec6bd5.js"><link rel="prefetch" href="/assets/js/39.f2a8f67b.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.d6a91950.js"><link rel="prefetch" href="/assets/js/41.7ecb6f91.js"><link rel="prefetch" href="/assets/js/42.320d53e8.js"><link rel="prefetch" href="/assets/js/43.10b3db87.js"><link rel="prefetch" href="/assets/js/44.c1368ca8.js"><link rel="prefetch" href="/assets/js/45.3f051966.js"><link rel="prefetch" href="/assets/js/46.88fde2e0.js"><link rel="prefetch" href="/assets/js/47.88e16c66.js"><link rel="prefetch" href="/assets/js/5.9221cc65.js"><link rel="prefetch" href="/assets/js/6.08529f20.js"><link rel="prefetch" href="/assets/js/7.d6f7c6a1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YuXing138</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elastic Menu" class="dropdown-title"><span class="title">Elastic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elastic Menu" class="mobile-dropdown-title"><span class="title">Elastic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elastic/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.4查询语言.html" class="nav-link">
  es1.4查询语言
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.8脚本.html" class="nav-link">
  es1.8脚本
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.2搜索.html" class="nav-link">
  es2.2搜索
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.7乐观并发控制.html" class="nav-link">
  es2.7乐观并发控制
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elastic Menu" class="dropdown-title"><span class="title">Elastic</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elastic Menu" class="mobile-dropdown-title"><span class="title">Elastic</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elastic/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.4查询语言.html" class="nav-link">
  es1.4查询语言
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.8脚本.html" class="nav-link">
  es1.8脚本
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.2搜索.html" class="nav-link">
  es2.2搜索
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elastic/es2.7乐观并发控制.html" class="nav-link">
  es2.7乐观并发控制
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Elastic</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Elastic/es1.1环境安装.html" class="sidebar-link">es1.1环境安装</a></li><li><a href="/Elastic/es1.2一些概念.html" class="sidebar-link">es1.2一些概念</a></li><li><a href="/Elastic/es1.3一些API.html" class="sidebar-link">es1.3一些API</a></li><li><a href="/Elastic/es1.4查询语言.html" class="sidebar-link">es1.4查询语言</a></li><li><a href="/Elastic/es1.5聚合查询.html" class="sidebar-link">es1.5聚合查询</a></li><li><a href="/Elastic/es1.6ORM.html" class="sidebar-link">es1.6ORM</a></li><li><a href="/Elastic/es1.7分析器.html" class="sidebar-link">es1.7分析器</a></li><li><a href="/Elastic/es1.8脚本.html" class="sidebar-link">es1.8脚本</a></li><li><a href="/Elastic/es1.8脚本语言.html" class="sidebar-link">es1.8脚本语言</a></li><li><a href="/Elastic/es1.9搜索建议.html" class="sidebar-link">es1.9搜索建议</a></li><li><a href="/Elastic/es2.1高可用性.html" class="sidebar-link">es2.1高可用性</a></li><li><a href="/Elastic/es2.2搜索.html" class="active sidebar-link">es2.2搜索</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#" class="sidebar-link">/</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#search-your-data-搜索" class="sidebar-link" style="padding-left:3rem;">Search your data（搜索）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#分页搜索结果-paginate-search-results" class="sidebar-link" style="padding-left:3rem;">分页搜索结果（Paginate search results）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#避免深度分页或过多结果" class="sidebar-link" style="padding-left:4rem;">避免深度分页或过多结果</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#search-after-在上页之后搜索" class="sidebar-link" style="padding-left:4rem;">Search after（在上页之后搜索）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#point-in-time-api-轻量级视图" class="sidebar-link" style="padding-left:4rem;">Point in time API（轻量级视图）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#scroll-search-results-滚动搜索结果" class="sidebar-link" style="padding-left:4rem;">Scroll search results（滚动搜索结果）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#排序搜索结果-sort-search-results" class="sidebar-link" style="padding-left:3rem;">排序搜索结果（Sort search results）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#排序顺序-sort-order" class="sidebar-link" style="padding-left:4rem;">排序顺序（Sort Order）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#跟踪分数-track-scores" class="sidebar-link" style="padding-left:4rem;">跟踪分数（Track Scores）</a></li><li class="sidebar-sub-header"><a href="/Elastic/es2.2搜索.html#内存注意事项-memory-considerations" class="sidebar-link" style="padding-left:4rem;">内存注意事项（Memory Considerations）</a></li></ul></li></ul></li><li><a href="/Elastic/es2.3倒排索引.html" class="sidebar-link">es2.3倒排索引</a></li><li><a href="/Elastic/es2.4地理查询.html" class="sidebar-link">es2.4地理查询</a></li><li><a href="/Elastic/es2.5一些概念.html" class="sidebar-link">es2.5一些概念</a></li><li><a href="/Elastic/es2.6相似性评分.html" class="sidebar-link">es2.6相似性评分</a></li><li><a href="/Elastic/es2.7乐观并发控制.html" class="sidebar-link">es2.7乐观并发控制</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id=""><a href="#" class="header-anchor">#</a> /</h2> <h4 id="search-your-data-搜索"><a href="#search-your-data-搜索" class="header-anchor">#</a> Search your data（搜索）</h4> <p>搜索查询或查询是对Elasticsearch数据流或索引中的数据信息的请求。<br>您可以将查询视为一个问题，以Elasticsearch理解的方式编写。根据您的数据，您可以使用查询来获得以下问题的答案：</p> <ul><li>我的服务器上哪些进程的响应时间超过500毫秒？</li> <li>上周我的网络上有哪些用户运行了regsvr32.exe？</li> <li>我的网站上的哪些页面包含特定的单词或短语？</li></ul> <p>搜索由一个或多个查询组成，这些查询被组合并发送到Elasticsearch。与搜索查询匹配的文档将在响应的命中数或搜索结果中返回。<br>搜索还可以包含用于更好地处理其查询的附加信息。例如，搜索可能仅限于特定索引，或者只返回特定数量的结果。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>Search your data 搜索您的数据
Collapse search results 折叠搜索结果
Filter search results 筛选搜索结果
Highlighting 突出显示
Long-running searches 长期搜索
Near real-time search 近实时搜索
Paginate search results 分页搜索结果
Retrieve inner hits 检索内部命中
Retrieve selected fields 检索所选字段
Search across clusters 跨集群搜索
Search multiple data streams and indices 搜索多个数据流和索引
Search shard routing 搜索碎片路由
Sort search results 对搜索结果排序
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="分页搜索结果-paginate-search-results"><a href="#分页搜索结果-paginate-search-results" class="header-anchor">#</a> 分页搜索结果（Paginate search results）</h4> <h5 id="避免深度分页或过多结果"><a href="#避免深度分页或过多结果" class="header-anchor">#</a> 避免深度分页或过多结果</h5> <p>默认情况下，搜索会返回前10个匹配的命中数。要浏览更大的结果集，可以使用搜索API的from和size参数。from参数定义要跳过的命中数，默认为0。size参数是要返回的最大命中数。这两个参数一起定义了一页结果。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>避免使用from和size过深地翻页或一次请求过多结果。搜索请求通常跨越多个碎片shards。每个碎片shard都必须将其请求的命中率和任何先前页面的命中率加载到内存中。对于深度页面或大型结果集，这些操作可能会显著增加内存和CPU使用率，从而导致性能下降或节点故障。<br>默认情况下，您不能使用from和size来浏览超过10000次点击。此限制是由index.max_result_window索引设置设置的保护措施。如果您需要浏览超过10000次点击，请改用search_after参数。<br>注意：Elasticsearch使用Lucene的内部文档ID作为决胜局tie-breakers。这些内部文档ID在相同数据的副本之间可能完全不同。当分页搜索命中时，您可能偶尔会看到具有相同排序值的文档排序不一致。</p> <h5 id="search-after-在上页之后搜索"><a href="#search-after-在上页之后搜索" class="header-anchor">#</a> Search after（在上页之后搜索）</h5> <p>您可以使用search_after参数，使用上一页中的一组排序值sort values来检索下一页的点击量。<br>使用search_after需要多个具有相同查询和排序值的搜索请求。如果在这些请求之间发生刷新，结果的顺序可能会发生变化，从而导致页面之间的结果不一致。为了防止这种情况，您可以创建一个时间点（PIT）来在搜索中保留当前索引状态。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#获取视图id
POST /my-index<span class="token number">-000001</span>/_pit?keep_alive=1m

#视图id
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span>
<span class="token punctuation">}</span>

#分页排序
GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elkbee&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//双排序字段</span>
    <span class="token punctuation">{</span><span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;_shard_doc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

#search_after
GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elkbee&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;_shard_doc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;search_after&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//Sort values来自上一次搜索的最后一次点击。</span>
    <span class="token number">4098435132000</span><span class="token punctuation">,</span>
    <span class="token number">4294967298</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;track_total_hits&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//禁用对total hits的跟踪以加快分页。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h5 id="point-in-time-api-轻量级视图"><a href="#point-in-time-api-轻量级视图" class="header-anchor">#</a> Point in time API（轻量级视图）</h5> <p>默认情况下，搜索请求针对目标索引的最新可见数据执行，该数据称为时间点。Elasticsearch pit（时间点）是一个轻量级的视图，可以查看数据在启动时的状态。在某些情况下，最好使用同一时间点执行多个搜索请求。例如，如果刷新发生在search_after请求之间，则这些请求的结果可能不一致，因为搜索之间发生的更改仅对最近的时间点可见。<br>先决条件</p> <ul><li>如果启用了Elasticsearch安全功能，则您必须具有目标数据流、索引或索引别名的读取索引权限。</li> <li>要在时间点（PIT）中搜索索引别名，您必须具有该别名的具体索引的读取索引权限。</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#在搜索请求中使用时间点之前，必须显式打开时间点。
#keep_alive参数告诉Elasticsearch它应该让一个时间点存活多长时间，例如?keep_alive=5m。
POST /my-index<span class="token number">-000001</span>/_pit?keep_alive=1m


#上述请求的结果包括一个id，该id应传递给搜索请求的pit参数的id。
POST /_search 
<span class="token punctuation">{</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elasticsearch&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="scroll-search-results-滚动搜索结果"><a href="#scroll-search-results-滚动搜索结果" class="header-anchor">#</a> Scroll search results（滚动搜索结果）</h5> <p>注意：我们不再建议使用scroll API进行深度分页。如果在分页超过10000次点击时需要保留索引状态，请使用带有时间点（PIT）的search_after参数。</p> <h4 id="排序搜索结果-sort-search-results"><a href="#排序搜索结果-sort-search-results" class="header-anchor">#</a> 排序搜索结果（Sort search results）</h4> <p>允许您在特定字段上添加一个或多个排序。每种排序也可以反过来。排序是在每个字段级别上定义的，使用特殊的字段名称_score按分数排序，使用_doc按索引顺序排序。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#假设以下索引映射：
PUT /my-index<span class="token number">-000001</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;post_date&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#多字段排序
GET /my-index<span class="token number">-000001</span>/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;sort&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;post_date&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;order&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token comment">//默认为asc</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;_score&quot;</span> <span class="token comment">//默认为desc</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>注意：_doc除了是最有效的排序顺序之外，没有任何实际的用例。因此，如果您不关心返回文档的顺序，那么您应该按_doc进行排序。这在滚动时尤其有用。</p> <h5 id="排序顺序-sort-order"><a href="#排序顺序-sort-order" class="header-anchor">#</a> 排序顺序（Sort Order）</h5> <p>在对_score排序时，顺序默认为desc，在对其他任何内容排序时，顺序默认为asc。</p> <h5 id="跟踪分数-track-scores"><a href="#跟踪分数-track-scores" class="header-anchor">#</a> 跟踪分数（Track Scores）</h5> <p>在字段上排序时，不会计算分数。通过将track_scores设置为true，分数仍将被计算和跟踪。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;track_scores&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;post_date&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;order&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="内存注意事项-memory-considerations"><a href="#内存注意事项-memory-considerations" class="header-anchor">#</a> 内存注意事项（Memory Considerations）</h5> <p>排序时，相关的已排序字段值将加载到内存中。这意味着每个碎片都应该有足够的内存来容纳它们。对于基于字符串的类型，不应分析/标记排序的字段。对于数字类型，如果可能，建议将类型显式设置为较窄的类型（如short、integer和float）。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Elastic/es2.1高可用性.html" class="prev">
        es2.1高可用性
      </a></span> <span class="next"><a href="/Elastic/es2.3倒排索引.html">
        es2.3倒排索引
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ce2a3b87.js" defer></script><script src="/assets/js/2.ae7b2f73.js" defer></script><script src="/assets/js/1.5784faf9.js" defer></script><script src="/assets/js/38.a2dbe0d8.js" defer></script>
  </body>
</html>
