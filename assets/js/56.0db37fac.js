(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{338:function(t,e,a){"use strict";a.r(e);var i=a(14),r=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:""}},[e("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")]),t._v(" /")]),t._v(" "),e("h4",{attrs:{id:"旁路缓存-cache-aside-pattern"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#旁路缓存-cache-aside-pattern"}},[t._v("#")]),t._v(" 旁路缓存（Cache Aside Pattern）")]),t._v(" "),e("p",[t._v("旁路缓存基本流程如下："),e("br"),e("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702352156051-f7a10a26-e7e0-4640-b259-b0d38d05223d.png#averageHue=%23f4f3f3&clientId=ubbfdc20e-08b0-4&from=paste&height=494&id=u837b2fb1&originHeight=1236&originWidth=835&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=119328&status=done&style=none&taskId=u03244136-2b2a-4cb8-b5b5-ae303f94fe6&title=&width=334",alt:"image.png"}})]),t._v(" "),e("h4",{attrs:{id:"先改数据库-再删缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先改数据库-再删缓存"}},[t._v("#")]),t._v(" 先改数据库，再删缓存")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702352120492-3256fd38-7ca0-453f-af39-65081dd37975.png#averageHue=%23f3f2f1&clientId=ubbfdc20e-08b0-4&from=paste&height=222&id=u16c3538d&originHeight=556&originWidth=1427&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=96134&status=done&style=none&taskId=u8d246f9a-efe8-4f8b-8c63-64824adce39&title=&width=570.8",alt:"image.png"}}),e("br"),t._v("这种情况是："),e("br"),t._v("先改数据库，再删缓存。如果删缓存失败，那么数据库中是新数据，缓存中是旧数据，数据不一致。"),e("br"),t._v("解决方法："),e("br"),t._v("先删缓存，再改数据库。如果其间缓存服务挂了，数据库未改，则数据一致。")]),t._v(" "),e("h4",{attrs:{id:"先删缓存-再改数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先删缓存-再改数据库"}},[t._v("#")]),t._v(" 先删缓存，再改数据库")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702352094572-d77ffbba-5cb7-4db3-9e60-b91711af11f8.png#averageHue=%23f5f4f3&clientId=ubbfdc20e-08b0-4&from=paste&height=420&id=uf104d46b&originHeight=1051&originWidth=1651&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=239729&status=done&style=none&taskId=u06afc787-8d86-496b-90b8-f5c9f1072f6&title=&width=660.4",alt:"image.png"}}),e("br"),t._v("这种情况是："),e("br"),t._v("请求1，先删除缓存，然后将要改数据库，还没改。。"),e("br"),t._v("请求2，先查缓存，发现缓存为空，再去查数据库，查到修改前的旧数据，放到了缓存中。"),e("br"),t._v("请求1，改数据库完成。"),e("br"),t._v("此时，数据库和缓存中的数据不一致。。"),e("br"),t._v("解决方法1："),e("br"),t._v("正如上图的场景，缓存中的库存虚高，但是数据库的库存是准的。这其实在业务上并不会出错，是可以容忍的。"),e("br"),t._v("解决方法2："),e("br"),t._v("这种场景，是读写并发造成的。只要让读写同步即可解决，比如：读写都上互斥锁、读写通过阻塞队列排序。。")]),t._v(" "),e("blockquote",[e("p",[t._v("注意：使用任务队列的方式，可能会有出现‘读库存x’‘读库存x’的情况，其中有一次‘改缓存’是多余的。")])])])}),[],!1,null,null,null);e.default=r.exports}}]);