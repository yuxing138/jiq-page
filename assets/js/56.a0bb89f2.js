(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{337:function(t,a,e){"use strict";e.r(a);var i=e(14),r=Object(i.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")]),t._v(" /")]),t._v(" "),a("h4",{attrs:{id:"旁路缓存-cache-aside-pattern"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#旁路缓存-cache-aside-pattern"}},[t._v("#")]),t._v(" 旁路缓存（Cache Aside Pattern）")]),t._v(" "),a("p",[t._v("旁路缓存基本流程如下："),a("br"),a("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702332428607-2b758b68-946d-417d-bb75-d30da06fcd4c.png#averageHue=%23f3f3f2&clientId=ub75a8fa1-562b-4&from=paste&height=491&id=uf37f20b7&originHeight=1228&originWidth=828&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=111498&status=done&style=none&taskId=u9dabbf04-61e0-4d44-bc17-2087a591712&title=&width=331.2",alt:"image.png"}})]),t._v(" "),a("h4",{attrs:{id:"先改数据库-再删缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#先改数据库-再删缓存"}},[t._v("#")]),t._v(" 先改数据库，再删缓存")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702326963774-7f0bd62e-b4b8-4324-91e4-66d3c777b24a.png#averageHue=%23f3f2f1&clientId=ub75a8fa1-562b-4&from=paste&height=222&id=u6280c369&originHeight=554&originWidth=1428&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=94795&status=done&style=none&taskId=ufb13849a-5bd7-48d8-b8d6-1fb7050e63d&title=&width=571.2",alt:"image.png"}}),a("br"),t._v("这种情况是："),a("br"),t._v("先改数据库，再删缓存。如果删缓存失败，那么数据库中是新数据，缓存中是旧数据，数据不一致。"),a("br"),t._v("解决方法："),a("br"),t._v("先删缓存，再改数据库。如果其间缓存服务挂了，数据库未改，则数据一致。")]),t._v(" "),a("h4",{attrs:{id:"先删缓存-再改数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#先删缓存-再改数据库"}},[t._v("#")]),t._v(" 先删缓存，再改数据库")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://jiq-picture.yuxing138.top/270583b791bd46107fab0578de31d51d/1702329264332-aaf385ea-988c-47a2-9791-87c7169d67f8.png#averageHue=%23f4f4f2&clientId=ub75a8fa1-562b-4&from=paste&height=423&id=ud86bc142&originHeight=1057&originWidth=1659&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=235432&status=done&style=none&taskId=u8543e3a2-152f-41b6-8892-322a71be67a&title=&width=663.6",alt:"image.png"}}),a("br"),t._v("这种情况是："),a("br"),t._v("请求1，先删除缓存，然后将要改数据库，还没改。。"),a("br"),t._v("请求2，先查缓存，发现缓存为空，再去查数据库，查到修改前的旧数据，放到了缓存中。"),a("br"),t._v("请求1，改数据库完成。"),a("br"),t._v("此时，数据库和缓存中的数据不一致。。"),a("br"),t._v("解决方法1："),a("br"),t._v("正如上图的场景，缓存中的库存虚高，但是数据库的库存是准的。这其实在业务上并不会出错，是可以容忍的。"),a("br"),t._v("解决方法2："),a("br"),t._v("这种场景，是读写并发造成的。只要让读写同步即可解决，比如：读写都上互斥锁、读写通过阻塞队列排序。。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意：使用任务队列的方式，可能会有出现‘读库存x’‘读库存x’的情况，其中有一次‘改缓存’是多余的。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);