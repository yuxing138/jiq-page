<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>/ | YuXing138</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.d017e306.js" as="script"><link rel="preload" href="/assets/js/2.ae7b2f73.js" as="script"><link rel="preload" href="/assets/js/1.5784faf9.js" as="script"><link rel="preload" href="/assets/js/35.96656f8c.js" as="script"><link rel="prefetch" href="/assets/js/10.11cd5bbe.js"><link rel="prefetch" href="/assets/js/11.d6f242fd.js"><link rel="prefetch" href="/assets/js/12.52955fb8.js"><link rel="prefetch" href="/assets/js/13.0171e0e6.js"><link rel="prefetch" href="/assets/js/14.e8630228.js"><link rel="prefetch" href="/assets/js/15.e3fe6a55.js"><link rel="prefetch" href="/assets/js/16.ed16aad5.js"><link rel="prefetch" href="/assets/js/17.9f06ecf6.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.66f6de90.js"><link rel="prefetch" href="/assets/js/20.2e3db1a8.js"><link rel="prefetch" href="/assets/js/21.ce1d45a6.js"><link rel="prefetch" href="/assets/js/22.da4a9ea1.js"><link rel="prefetch" href="/assets/js/23.a3f0a356.js"><link rel="prefetch" href="/assets/js/24.67ac9cfd.js"><link rel="prefetch" href="/assets/js/25.5168571e.js"><link rel="prefetch" href="/assets/js/26.fd79c19e.js"><link rel="prefetch" href="/assets/js/27.251dedac.js"><link rel="prefetch" href="/assets/js/28.3556ecfb.js"><link rel="prefetch" href="/assets/js/29.0ca32d78.js"><link rel="prefetch" href="/assets/js/3.e5de98dd.js"><link rel="prefetch" href="/assets/js/30.d9da3fd8.js"><link rel="prefetch" href="/assets/js/31.2bf6f0a7.js"><link rel="prefetch" href="/assets/js/32.e0b4e070.js"><link rel="prefetch" href="/assets/js/33.78a9e22e.js"><link rel="prefetch" href="/assets/js/34.582c748e.js"><link rel="prefetch" href="/assets/js/36.83b92944.js"><link rel="prefetch" href="/assets/js/37.c7ef6d03.js"><link rel="prefetch" href="/assets/js/38.f1b71f6b.js"><link rel="prefetch" href="/assets/js/39.db15b014.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.e5dc69c4.js"><link rel="prefetch" href="/assets/js/41.fd4968d3.js"><link rel="prefetch" href="/assets/js/42.d3e66f9e.js"><link rel="prefetch" href="/assets/js/43.e89cf854.js"><link rel="prefetch" href="/assets/js/44.334f7f93.js"><link rel="prefetch" href="/assets/js/45.27f1ff88.js"><link rel="prefetch" href="/assets/js/46.da51712c.js"><link rel="prefetch" href="/assets/js/47.865c7bf0.js"><link rel="prefetch" href="/assets/js/48.4dbb2825.js"><link rel="prefetch" href="/assets/js/49.eda65241.js"><link rel="prefetch" href="/assets/js/5.9221cc65.js"><link rel="prefetch" href="/assets/js/50.3673dc7f.js"><link rel="prefetch" href="/assets/js/51.8aaaa66d.js"><link rel="prefetch" href="/assets/js/52.2494bd24.js"><link rel="prefetch" href="/assets/js/53.eadb8a5a.js"><link rel="prefetch" href="/assets/js/54.7fe4b62c.js"><link rel="prefetch" href="/assets/js/55.a5d9e392.js"><link rel="prefetch" href="/assets/js/6.08529f20.js"><link rel="prefetch" href="/assets/js/7.d6f7c6a1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YuXing138</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis2.1数据交互.html" class="nav-link">
  redis2.1数据交互
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1Redis对象.html" class="nav-link">
  redis3.1Redis对象
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.2LFU算法.html" class="nav-link">
  redis3.2LFU算法
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.3dict.html" class="nav-link">
  redis3.3dict
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.4embstr.html" class="nav-link">
  redis3.4embstr
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.5hash.html" class="nav-link">
  redis3.5hash
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.6skiplist.html" class="nav-link">
  redis3.6skiplist
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.1持久性.html" class="nav-link">
  redis4.1持久性
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.2副本.html" class="nav-link">
  redis4.2副本
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.3哨兵.html" class="nav-link">
  redis4.3哨兵
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.4集群.html" class="nav-link">
  redis4.4集群
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis2.1数据交互.html" class="nav-link">
  redis2.1数据交互
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1Redis对象.html" class="nav-link">
  redis3.1Redis对象
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.2LFU算法.html" class="nav-link">
  redis3.2LFU算法
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.3dict.html" class="nav-link">
  redis3.3dict
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.4embstr.html" class="nav-link">
  redis3.4embstr
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.5hash.html" class="nav-link">
  redis3.5hash
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.6skiplist.html" class="nav-link">
  redis3.6skiplist
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.1持久性.html" class="nav-link">
  redis4.1持久性
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.2副本.html" class="nav-link">
  redis4.2副本
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.3哨兵.html" class="nav-link">
  redis4.3哨兵
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.4集群.html" class="nav-link">
  redis4.4集群
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Elasticsearch/es1.1环境安装.html" class="sidebar-link">es1.1环境安装</a></li><li><a href="/Elasticsearch/es1.2一些概念.html" class="sidebar-link">es1.2一些概念</a></li><li><a href="/Elasticsearch/es1.3一些API.html" class="sidebar-link">es1.3一些API</a></li><li><a href="/Elasticsearch/es1.4查询.html" class="sidebar-link">es1.4查询</a></li><li><a href="/Elasticsearch/es1.5聚合查询.html" class="sidebar-link">es1.5聚合查询</a></li><li><a href="/Elasticsearch/es1.6ORM.html" class="sidebar-link">es1.6ORM</a></li><li><a href="/Elasticsearch/es1.7分析器.html" class="sidebar-link">es1.7分析器</a></li><li><a href="/Elasticsearch/es1.8脚本语言.html" class="sidebar-link">es1.8脚本语言</a></li><li><a href="/Elasticsearch/es1.9搜索建议.html" class="sidebar-link">es1.9搜索建议</a></li><li><a href="/Elasticsearch/es2.1高可用性.html" class="sidebar-link">es2.1高可用性</a></li><li><a href="/Elasticsearch/es2.2搜索查询.html" class="active sidebar-link">es2.2搜索查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#" class="sidebar-link">/</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#search-your-data-搜索" class="sidebar-link" style="padding-left:3rem;">Search your data（搜索）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#分页搜索结果-paginate-search-results" class="sidebar-link" style="padding-left:3rem;">分页搜索结果（Paginate search results）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#避免深度分页或过多结果" class="sidebar-link" style="padding-left:4rem;">避免深度分页或过多结果</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#search-after-在上页之后搜索" class="sidebar-link" style="padding-left:4rem;">Search after（在上页之后搜索）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#point-in-time-api-轻量级视图" class="sidebar-link" style="padding-left:4rem;">Point in time API（轻量级视图）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#scroll-search-results-滚动搜索结果" class="sidebar-link" style="padding-left:4rem;">Scroll search results（滚动搜索结果）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#排序搜索结果-sort-search-results" class="sidebar-link" style="padding-left:3rem;">排序搜索结果（Sort search results）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#排序顺序-sort-order" class="sidebar-link" style="padding-left:4rem;">排序顺序（Sort Order）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#跟踪分数-track-scores" class="sidebar-link" style="padding-left:4rem;">跟踪分数（Track Scores）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#内存注意事项-memory-considerations" class="sidebar-link" style="padding-left:4rem;">内存注意事项（Memory Considerations）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#高亮显示-highlighting" class="sidebar-link" style="padding-left:3rem;">高亮显示（Highlighting）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#统一荧光笔-unified-highlighter" class="sidebar-link" style="padding-left:4rem;">统一荧光笔（Unified highlighter）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#普通荧光笔-plain-highlighter" class="sidebar-link" style="padding-left:4rem;">普通荧光笔（Plain highlighter）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#fvh荧光笔-fast-vector-highlighter" class="sidebar-link" style="padding-left:4rem;">FVH荧光笔（Fast vector highlighter）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#控制高亮片段-control-highlighted-fragments" class="sidebar-link" style="padding-left:4rem;">控制高亮片段（Control highlighted fragments）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#荧光笔内部工作原理-how-highlighters-work-internally" class="sidebar-link" style="padding-left:4rem;">荧光笔内部工作原理（How highlighters work internally）</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#如何将文本分解成碎片" class="sidebar-link" style="padding-left:5rem;">如何将文本分解成碎片？</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#如何找到最好的碎片" class="sidebar-link" style="padding-left:5rem;">如何找到最好的碎片？</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#如何在片段中突出显示查询词" class="sidebar-link" style="padding-left:5rem;">如何在片段中突出显示查询词？</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#term-vectors-api" class="sidebar-link" style="padding-left:4rem;">Term vectors API</a></li><li class="sidebar-sub-header"><a href="/Elasticsearch/es2.2搜索查询.html#term-vector" class="sidebar-link" style="padding-left:4rem;">term_vector</a></li></ul></li></ul></li><li><a href="/Elasticsearch/es2.3倒排索引.html" class="sidebar-link">es2.3倒排索引</a></li><li><a href="/Elasticsearch/es2.4地理查询.html" class="sidebar-link">es2.4地理查询</a></li><li><a href="/Elasticsearch/es2.5一些概念.html" class="sidebar-link">es2.5一些概念</a></li><li><a href="/Elasticsearch/es2.6相似性评分.html" class="sidebar-link">es2.6相似性评分</a></li><li><a href="/Elasticsearch/es2.7索引.html" class="sidebar-link">es2.7索引</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id=""><a href="#" class="header-anchor">#</a> /</h2> <h4 id="search-your-data-搜索"><a href="#search-your-data-搜索" class="header-anchor">#</a> Search your data（搜索）</h4> <p>搜索查询或查询是对Elasticsearch数据流或索引中的数据信息的请求。<br>您可以将查询视为一个问题，以Elasticsearch理解的方式编写。根据您的数据，您可以使用查询来获得以下问题的答案：</p> <ul><li>我的服务器上哪些进程的响应时间超过500毫秒？</li> <li>上周我的网络上有哪些用户运行了regsvr32.exe？</li> <li>我的网站上的哪些页面包含特定的单词或短语？</li></ul> <p>搜索由一个或多个查询组成，这些查询被组合并发送到Elasticsearch。与搜索查询匹配的文档将在响应的命中数或搜索结果中返回。<br>搜索还可以包含用于更好地处理其查询的附加信息。例如，搜索可能仅限于特定索引，或者只返回特定数量的结果。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>Search your data 搜索您的数据
Collapse search results 折叠搜索结果
Filter search results 筛选搜索结果
Highlighting 突出显示
Long-running searches 长期搜索
Near real-time search 近实时搜索
Paginate search results 分页搜索结果
Retrieve inner hits 检索内部命中
Retrieve selected fields 检索所选字段
Search across clusters 跨集群搜索
Search multiple data streams and indices 搜索多个数据流和索引
Search shard routing 搜索碎片路由
Sort search results 对搜索结果排序
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="分页搜索结果-paginate-search-results"><a href="#分页搜索结果-paginate-search-results" class="header-anchor">#</a> 分页搜索结果（Paginate search results）</h4> <h5 id="避免深度分页或过多结果"><a href="#避免深度分页或过多结果" class="header-anchor">#</a> 避免深度分页或过多结果</h5> <p>默认情况下，搜索会返回前10个匹配的命中数。要浏览更大的结果集，可以使用搜索API的from和size参数。from参数定义要跳过的命中数，默认为0。size参数是要返回的最大命中数。这两个参数一起定义了一页结果。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>避免使用from和size过深地翻页或一次请求过多结果。搜索请求通常跨越多个碎片shards。每个碎片shard都必须将其请求的命中率和任何先前页面的命中率加载到内存中。对于深度页面或大型结果集，这些操作可能会显著增加内存和CPU使用率，从而导致性能下降或节点故障。<br>默认情况下，您不能使用from和size来浏览超过10000次点击。此限制是由index.max_result_window索引设置设置的保护措施。如果您需要浏览超过10000次点击，请改用search_after参数。<br>注意：Elasticsearch使用Lucene的内部文档ID作为决胜局tie-breakers。这些内部文档ID在相同数据的副本之间可能完全不同。当分页搜索命中时，您可能偶尔会看到具有相同排序值的文档排序不一致。</p> <h5 id="search-after-在上页之后搜索"><a href="#search-after-在上页之后搜索" class="header-anchor">#</a> Search after（在上页之后搜索）</h5> <p>您可以使用search_after参数，使用上一页中的一组排序值sort values来检索下一页的点击量。<br>使用search_after需要多个具有相同查询和排序值的搜索请求。如果在这些请求之间发生刷新，结果的顺序可能会发生变化，从而导致页面之间的结果不一致。为了防止这种情况，您可以创建一个时间点（PIT）来在搜索中保留当前索引状态。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#获取视图id
POST /my-index<span class="token number">-000001</span>/_pit?keep_alive=1m

#视图id
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span>
<span class="token punctuation">}</span>

#分页排序
GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elkbee&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//双排序字段</span>
    <span class="token punctuation">{</span><span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;_shard_doc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

#search_after
GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;user.id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elkbee&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">&quot;@timestamp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">&quot;_shard_doc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;search_after&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">//Sort values来自上一次搜索的最后一次点击。</span>
    <span class="token number">4098435132000</span><span class="token punctuation">,</span>
    <span class="token number">4294967298</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;track_total_hits&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//禁用对total hits的跟踪以加快分页。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h5 id="point-in-time-api-轻量级视图"><a href="#point-in-time-api-轻量级视图" class="header-anchor">#</a> Point in time API（轻量级视图）</h5> <p>默认情况下，搜索请求针对目标索引的最新可见数据执行，该数据称为时间点。Elasticsearch pit（时间点）是一个轻量级的视图，可以查看数据在启动时的状态。在某些情况下，最好使用同一时间点执行多个搜索请求。例如，如果刷新发生在search_after请求之间，则这些请求的结果可能不一致，因为搜索之间发生的更改仅对最近的时间点可见。<br>先决条件</p> <ul><li>如果启用了Elasticsearch安全功能，则您必须具有目标数据流、索引或索引别名的读取索引权限。</li> <li>要在时间点（PIT）中搜索索引别名，您必须具有该别名的具体索引的读取索引权限。</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#在搜索请求中使用时间点之前，必须显式打开时间点。
#keep_alive参数告诉Elasticsearch它应该让一个时间点存活多长时间，例如?keep_alive=5m。
POST /my-index<span class="token number">-000001</span>/_pit?keep_alive=1m


#上述请求的结果包括一个id，该id应传递给搜索请求的pit参数的id。
POST /_search 
<span class="token punctuation">{</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;elasticsearch&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pit&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;46ToAwMDaWR5BXV1aWQyKwZub2RlXzMAAAAAAAAAACoBYwADaWR4BXV1aWQxAgZub2RlXzEAAAAAAAAAAAEBYQADaWR5BXV1aWQyKgZub2RlXzIAAAAAAAAAAAwBYgACBXV1aWQyAAAFdXVpZDEAAQltYXRjaF9hbGw_gAAAAA==&quot;</span><span class="token punctuation">,</span> 
	    <span class="token property">&quot;keep_alive&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1m&quot;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="scroll-search-results-滚动搜索结果"><a href="#scroll-search-results-滚动搜索结果" class="header-anchor">#</a> Scroll search results（滚动搜索结果）</h5> <p>注意：我们不再建议使用scroll API进行深度分页。如果在分页超过10000次点击时需要保留索引状态，请使用带有时间点（PIT）的search_after参数。</p> <h4 id="排序搜索结果-sort-search-results"><a href="#排序搜索结果-sort-search-results" class="header-anchor">#</a> 排序搜索结果（Sort search results）</h4> <p>允许您在特定字段上添加一个或多个排序。每种排序也可以反过来。排序是在每个字段级别上定义的，使用特殊的字段名称_score按分数排序，使用_doc按索引顺序排序。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#假设以下索引映射：
PUT /my-index<span class="token number">-000001</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;post_date&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;date&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;user&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#多字段排序
GET /my-index<span class="token number">-000001</span>/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;sort&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;post_date&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;order&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token comment">//默认为asc</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;_score&quot;</span> <span class="token comment">//默认为desc</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>注意：_doc除了是最有效的排序顺序之外，没有任何实际的用例。因此，如果您不关心返回文档的顺序，那么您应该按_doc进行排序。这在滚动时尤其有用。</p> <h5 id="排序顺序-sort-order"><a href="#排序顺序-sort-order" class="header-anchor">#</a> 排序顺序（Sort Order）</h5> <p>在对_score排序时，顺序默认为desc，在对其他任何内容排序时，顺序默认为asc。</p> <h5 id="跟踪分数-track-scores"><a href="#跟踪分数-track-scores" class="header-anchor">#</a> 跟踪分数（Track Scores）</h5> <p>在字段上排序时，不会计算分数。通过将track_scores设置为true，分数仍将被计算和跟踪。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;track_scores&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;sort&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;post_date&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;order&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;desc&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;term&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="内存注意事项-memory-considerations"><a href="#内存注意事项-memory-considerations" class="header-anchor">#</a> 内存注意事项（Memory Considerations）</h5> <p>排序时，相关的已排序字段值将加载到内存中。这意味着每个碎片都应该有足够的内存来容纳它们。对于基于字符串的类型，不应分析/标记排序的字段。对于数字类型，如果可能，建议将类型显式设置为较窄的类型（如short、integer和float）。</p> <h4 id="高亮显示-highlighting"><a href="#高亮显示-highlighting" class="header-anchor">#</a> 高亮显示（Highlighting）</h4> <p>高亮显示使您能够从搜索结果中的一个或多个字段中获取高亮显示的片段，以便向用户显示查询匹配的位置。当您请求高亮显示时，响应会为每个搜索命中包含一个额外的高亮显示元素，其中包括高亮显示的字段和高亮显示的片段。<br>注意：高亮显示在提取要高亮显示的术语时不会反映查询的布尔逻辑。因此，对于一些复杂的布尔查询（例如嵌套布尔查询、使用minimum_should_match的查询等），文档中与查询匹配不对应的部分可能会被突出显示。<br>高亮显示需要字段的实际内容。如果未存储字段（映射未将store设置为true），则加载实际的_source，并从_source中提取相关字段。<br>例如，要使用默认荧光笔获取每个搜索命中中内容字段的高亮显示，请在指定内容字段的请求正文中包含一个高亮显示对象：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET example/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Elasticsearch支持三种荧光笔：统一荧光笔、普通荧光笔和fvh（快速矢量荧光笔）。您可以指定要用于每个字段的荧光笔类型。</p> <h5 id="统一荧光笔-unified-highlighter"><a href="#统一荧光笔-unified-highlighter" class="header-anchor">#</a> 统一荧光笔（Unified highlighter）</h5> <p>统一荧光笔使用Lucene统一荧光笔。这种荧光笔将文本分解为句子，并使用BM25算法对单个句子进行评分，就好像它们是语料库中的文档一样。它还支持精确的短语和多术语（模糊、前缀、正则表达式）突出显示。这是默认的荧光笔。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>DELETE example
PUT /example
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;english&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;term_vector&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;with_positions_offsets&quot;</span><span class="token comment">//否则不支持fvh</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST example/_create/<span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;中文内容&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;中文注释&quot;</span>
<span class="token punctuation">}</span>
POST example/_create/<span class="token number">2</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文内容&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文注释&quot;</span>
<span class="token punctuation">}</span>

GET example/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

#返回结果
<span class="token punctuation">{</span>
  <span class="token property">&quot;took&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">&quot;timed_out&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_shards&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;successful&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;skipped&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;failed&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;hits&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;total&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;value&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;relation&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;eq&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;max_score&quot;</span> <span class="token operator">:</span> <span class="token number">0.8754687</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hits&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_score&quot;</span> <span class="token operator">:</span> <span class="token number">0.8754687</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;content&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;英文内容&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;英文注释&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;highlight&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;&lt;em&gt;英&lt;/em&gt;&lt;em&gt;文&lt;/em&gt;注释&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;example&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_score&quot;</span> <span class="token operator">:</span> <span class="token number">0.18232156</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;content&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;中文内容&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;中文注释&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;highlight&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;中&lt;em&gt;文&lt;/em&gt;注释&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div><h5 id="普通荧光笔-plain-highlighter"><a href="#普通荧光笔-plain-highlighter" class="header-anchor">#</a> 普通荧光笔（Plain highlighter）</h5> <p>普通荧光笔使用标准Lucene荧光笔。它试图从理解单词重要性和短语查询中的任何单词定位标准的角度来反映查询匹配逻辑。<br>注意：普通荧光笔最适合在单个字段中突出显示简单的查询匹配。为了准确反映查询逻辑，它在内存中创建了一个微小的索引，并通过Lucene的查询执行计划器重新运行原始查询条件，以访问当前文档的低级别匹配信息。对于需要突出显示的每个字段和每个文档，都会重复此操作。如果您想突出显示具有复杂查询的许多文档中的许多字段，我们建议在postings或term_vector字段上使用unified的高亮显示。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET example/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;plain&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="fvh荧光笔-fast-vector-highlighter"><a href="#fvh荧光笔-fast-vector-highlighter" class="header-anchor">#</a> FVH荧光笔（Fast vector highlighter）</h5> <p>fvh荧光笔使用Lucene Fast Vector荧光笔。此荧光笔可用于映射中term_vector设置为with_positions_offset的字段。快速矢量荧光笔：</p> <ul><li>可以使用boundary_scanner进行自定义。</li> <li>需要将term_vector设置为带有_positions_offsets，这会增加索引的大小</li> <li>可以将多个字段中的匹配项组合为一个结果。请参阅matched_fields</li> <li>可以为不同位置的匹配分配不同的权重，允许在突出显示将短语匹配提升到术语匹配之上的Boosting Query时，将短语匹配排序在术语匹配之上</li></ul> <p>注意：fvh荧光笔不支持span查询。如果您需要对span查询的支持，请尝试其他荧光笔，例如统一荧光笔。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET example/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token string">&quot;英文&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fvh&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="控制高亮片段-control-highlighted-fragments"><a href="#控制高亮片段-control-highlighted-fragments" class="header-anchor">#</a> 控制高亮片段（Control highlighted fragments）</h5> <p>每个高亮显示的字段都可以控制高亮显示的片段的大小（默认为100），以及返回的最大片段数（默认为5）。例如：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;fragment_size&quot;</span> <span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token property">&quot;number_of_fragments&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>除此之外，还可以指定高亮显示的片段需要按分数排序：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;order&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;score&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;fields&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;fragment_size&quot;</span> <span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token property">&quot;number_of_fragments&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果number_of_frances值设置为0，则不会生成任何片段，而是返回字段的全部内容，当然还会突出显示。如果需要突出显示短文本（如文档标题或地址），但不需要分段，这将非常方便。请注意，在这种情况下会忽略fragment_size。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;body&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;blog.title&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;number_of_fragments&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>使用fvh时，可以使用fragment_offset参数来控制开始高亮显示的边距。<br>在没有要突出显示的匹配片段的情况下，默认情况是不返回任何内容。相反，我们可以通过将no_match_size（默认值为0）设置为要返回的文本长度，从字段开头返回一段文本。实际长度可能比指定的短或长，因为它试图打破单词边界。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;user.id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kimchy&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;comment&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;fragment_size&quot;</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
        <span class="token property">&quot;number_of_fragments&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token property">&quot;no_match_size&quot;</span><span class="token operator">:</span> <span class="token number">150</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="荧光笔内部工作原理-how-highlighters-work-internally"><a href="#荧光笔内部工作原理-how-highlighters-work-internally" class="header-anchor">#</a> 荧光笔内部工作原理（How highlighters work internally）</h5> <p>给定一个查询和一个文本（文档字段的内容），高亮显示的目标是找到查询的最佳文本片段，并突出显示找到的片段中的查询术语。为此，荧光笔需要解决以下几个问题：</p> <ul><li>如何将文本分解成碎片？</li> <li>如何在所有碎片中找到最好的碎片？</li> <li>如何在片段中突出显示查询词？</li></ul> <h6 id="如何将文本分解成碎片"><a href="#如何将文本分解成碎片" class="header-anchor">#</a> 如何将文本分解成碎片？</h6> <p>相关设置：fragment_size、fragmenter、荧光笔类型、boundary_chars、boundary_max_scan、boundary_scanner、boundary_scanner_locate。<br>普通荧光笔首先使用给定的分析器分析文本，并从中创建令牌流。普通荧光笔使用一个非常简单的算法将令牌流分解为片段。它循环遍历令牌流中的术语，每当当前术语的end_offset超过fragment_size乘以创建的片段数时，就会创建一个新的片段。使用span fragmenter可以进行更多的计算，以避免在高亮显示的术语之间分解文本。但总的来说，由于中断只能通过fragment_size来完成，因此有些片段可能很奇怪，例如以标点符号开头。<br>Unified或FVH荧光笔可以更好地利用Java的BreakIterator将文本分解为片段。这确保了只要fragment_size允许，片段就是一个有效的句子。<br>注意：</p> <ul><li>普通荧光笔使用一个非常简单的算法将令牌流分解为片段。</li> <li>Unified或FVH荧光笔可以更好地利用Java的BreakIterator将文本分解为片段。</li></ul> <h6 id="如何找到最好的碎片"><a href="#如何找到最好的碎片" class="header-anchor">#</a> 如何找到最好的碎片？</h6> <p>相关设置：number_of_frances。<br>为了找到最好、最相关的片段，荧光笔需要根据给定的查询对每个片段进行评分。目标是只对那些参与生成文档命中率的术语进行评分。对于一些复杂的查询，这项工作仍在进行中。<br>普通的highlighter从当前的令牌流创建一个内存中的索引，并通过Lucene的查询执行计划器重新运行原始查询条件，以访问当前文本的低级别匹配信息。对于更复杂的查询，可以将原始查询转换为跨度查询，因为跨度查询可以更准确地处理短语。然后，使用该获得的低级别匹配信息来对每个单独片段进行评分。普通荧光笔的评分方法很简单。每个片段都根据在该片段中找到的唯一查询项的数量进行评分。单个术语的分数等于其提升，默认为1。因此，默认情况下，包含一个唯一查询项的片段将获得1分；而一个包含两个唯一查询项的片段将获得2分，依此类推。然后根据分数对片段进行排序，因此将首先输出得分最高的片段。<br>FVH不需要分析文本并构建内存索引，因为它使用预先索引的文档术语向量，并在其中找到与查询相对应的术语。FVH根据在该片段中找到的查询词的数量对每个片段进行评分。和普通荧光笔类似，单个项的得分等于其提升值。与普通的高亮显示不同，所有查询术语都会被计算在内，而不仅仅是唯一的术语。<br>统一荧光笔可以使用预索引项向量或预索引项偏移量（如果可用）。否则，与普通Highlighter类似，它必须从文本中创建内存索引。统一荧光笔使用BM25评分模型对碎片进行评分。<br>注意：</p> <ul><li>默认情况下，包含一个唯一查询项的片段将获得1分；而一个包含两个唯一查询项的片段将获得2分，依此类推。然后根据分数对片段进行排序，因此将首先输出得分最高的片段。</li> <li>普通的highlighter从当前的令牌流创建一个内存中的索引，并通过Lucene的查询执行计划器重新运行原始查询条件，以访问当前文本的低级别匹配信息。</li> <li>FVH不需要分析文本并构建内存索引，因为它使用预先索引的文档术语向量，并在其中找到与查询相对应的术语。</li> <li>统一荧光笔可以使用预索引项向量或预索引项偏移量（如果可用）。</li></ul> <h6 id="如何在片段中突出显示查询词"><a href="#如何在片段中突出显示查询词" class="header-anchor">#</a> 如何在片段中突出显示查询词？</h6> <p>相关设置：前置标签、后置标签。<br>目标是只强调那些参与生成文档命中率的术语。对于一些复杂的布尔查询，这项工作仍在进行中，因为高亮显示不反映查询的布尔逻辑，只提取叶（术语、短语、前缀等）查询。<br>在给定令牌流和原始文本的情况下，普通高亮显示会重新组合原始文本，以仅突出显示令牌流中包含在前一步骤的低级别匹配信息结构中的术语。<br>FVH和统一荧光笔使用中间数据结构以某种原始形式表示片段，然后用实际文本填充它们。<br>荧光笔使用前标签和后标签对高亮显示的术语进行编码。<br>注意：</p> <ul><li>普通高亮显示会重新组合原始文本，以仅突出显示令牌流中包含在前一步骤的低级别匹配信息结构中的术语。</li> <li>FVH和统一荧光笔使用中间数据结构以某种原始形式表示片段，然后用实际文本填充它们。</li></ul> <h5 id="term-vectors-api"><a href="#term-vectors-api" class="header-anchor">#</a> Term vectors API</h5> <div class="language-json line-numbers-mode"><pre class="language-json"><code>REST APIs
API conventions
Autoscaling APIs
Compact and aligned text (CAT) APIs
Cluster APIs
Cross-cluster replication APIs
Data stream APIs
Document APIs
Enrich APIs
Features APIs
Find structure API
Graph explore API
Index APIs
Index lifecycle management APIs
Ingest APIs
Info API
Licensing APIs
Logstash APIs
Machine learning anomaly detection APIs
Machine learning data frame analytics APIs
Migration APIs
Reload search analyzers API
Repositories metering APIs
Rollup APIs
Script APIs
Search APIs
Searchable snapshots APIs
Security APIs
Snapshot and restore APIs
Snapshot lifecycle management APIs
Transform APIs
Usage API
Watcher APIs
Definitions
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code>Document APIs
Reading and Writing documents
Index
Get
Delete
Delete by query
Update
Update by query
Multi get
Bulk
Reindex
Term vectors
Multi term vectors
?refresh
Optimistic concurrency control
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>首先，我们创建一个索引，用于存储术语向量、有效载荷等：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /my-index<span class="token number">-000001</span>
<span class="token punctuation">{</span> <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;term_vector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;with_positions_offsets_payloads&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;store&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;fulltext_analyzer&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token property">&quot;fullname&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;term_vector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;with_positions_offsets_payloads&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;analyzer&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;fulltext_analyzer&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;number_of_shards&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number_of_replicas&quot;</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;analysis&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;fulltext_analyzer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;tokenizer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;whitespace&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;lowercase&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type_as_payload&quot;</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>其次，我们添加一些文档：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT /my-index<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;fullname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test test test &quot;</span>
<span class="token punctuation">}</span>

PUT /my-index<span class="token number">-000001</span>/_doc/<span class="token number">2</span>?refresh=wait_for
<span class="token punctuation">{</span>
  <span class="token property">&quot;fullname&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Jane Doe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Another test ...&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以下请求返回文档1（John Doe）中字段文本的所有信息和统计信息：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET /my-index<span class="token number">-000001</span>/_termvectors/<span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;fields&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;offsets&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;payloads&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;positions&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;term_statistics&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;field_statistics&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>响应：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-index-000001&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_doc&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_version&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;found&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;took&quot;</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
  <span class="token property">&quot;term_vectors&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;field_statistics&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;sum_doc_freq&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token property">&quot;doc_count&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sum_ttf&quot;</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;doc_freq&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token property">&quot;ttf&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
          <span class="token property">&quot;term_freq&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token property">&quot;tokens&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token property">&quot;start_offset&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token property">&quot;end_offset&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
              <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d29yZA==&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token property">&quot;start_offset&quot;</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
              <span class="token property">&quot;end_offset&quot;</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
              <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d29yZA==&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
              <span class="token property">&quot;start_offset&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
              <span class="token property">&quot;end_offset&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
              <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d29yZA==&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h5 id="term-vector"><a href="#term-vector" class="header-anchor">#</a> term_vector</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>Mapping
Dynamic mapping
Explicit mapping
Runtime fields
Field data types
Metadata fields
Mapping parameters
Mapping limit settings
Removal of mapping types
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>Mapping parameters
analyzer
boost
coerce
copy_to
doc_values
dynamic
eager_global_ordinals
enabled
format
ignore_above
ignore_malformed
index
index_options
index_phrases
index_prefixes
meta
fields
normalizer
norms
null_value
position_increment_gap
properties
search_analyzer
similarity
store
term_vector
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>术语向量包含有关分析过程产生的术语的信息，包括：</p> <ul><li>术语列表。</li> <li>每个术语的位置（或顺序）。</li> <li>将术语映射到原始字符串中其原点的起始字符偏移和结束字符偏移。</li> <li>有效载荷（如果可用）——与每个术语位置相关联的用户定义的二进制数据。</li></ul> <p>term_vector可选项：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>no                             |No term vectors are stored. (default)
yes                            |Just the terms in the field are stored.
with_positions                 |Terms and positions are stored.
with_offsets                   |Terms and character offsets are stored.
with_positions_offsets         |Terms, positions, and character offsets are stored.
with_positions_payloads        |Terms, positions, and payloads are stored.
with_positions_offsets_payloads|Terms, positions, offsets and payloads are stored.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意：设置with_positions_offsets 将使字段索引的大小加倍。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT my-index<span class="token number">-000001</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;mappings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span>        <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;term_vector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;with_positions_offsets&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

PUT my-index<span class="token number">-000001</span>/_doc/<span class="token number">1</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Quick brown fox&quot;</span>
<span class="token punctuation">}</span>

GET my-index<span class="token number">-000001</span>/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;brown fox&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Elasticsearch/es2.1高可用性.html" class="prev">
        es2.1高可用性
      </a></span> <span class="next"><a href="/Elasticsearch/es2.3倒排索引.html">
        es2.3倒排索引
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d017e306.js" defer></script><script src="/assets/js/2.ae7b2f73.js" defer></script><script src="/assets/js/1.5784faf9.js" defer></script><script src="/assets/js/35.96656f8c.js" defer></script>
  </body>
</html>
