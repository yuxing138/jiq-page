<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>/ | YuXing138</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9f84806b.css" as="style"><link rel="preload" href="/assets/js/app.0aa5cc29.js" as="script"><link rel="preload" href="/assets/js/2.ae7b2f73.js" as="script"><link rel="preload" href="/assets/js/1.5784faf9.js" as="script"><link rel="preload" href="/assets/js/51.5b9684cc.js" as="script"><link rel="prefetch" href="/assets/js/10.11cd5bbe.js"><link rel="prefetch" href="/assets/js/11.d6f242fd.js"><link rel="prefetch" href="/assets/js/12.52955fb8.js"><link rel="prefetch" href="/assets/js/13.0171e0e6.js"><link rel="prefetch" href="/assets/js/14.e8630228.js"><link rel="prefetch" href="/assets/js/15.e3fe6a55.js"><link rel="prefetch" href="/assets/js/16.ed16aad5.js"><link rel="prefetch" href="/assets/js/17.9f06ecf6.js"><link rel="prefetch" href="/assets/js/18.4c170722.js"><link rel="prefetch" href="/assets/js/19.66f6de90.js"><link rel="prefetch" href="/assets/js/20.2e3db1a8.js"><link rel="prefetch" href="/assets/js/21.ce1d45a6.js"><link rel="prefetch" href="/assets/js/22.46293926.js"><link rel="prefetch" href="/assets/js/23.21ecbc39.js"><link rel="prefetch" href="/assets/js/24.bbf3ef31.js"><link rel="prefetch" href="/assets/js/25.eb8958ba.js"><link rel="prefetch" href="/assets/js/26.7d83783c.js"><link rel="prefetch" href="/assets/js/27.31af3d2f.js"><link rel="prefetch" href="/assets/js/28.c7392606.js"><link rel="prefetch" href="/assets/js/29.025230cb.js"><link rel="prefetch" href="/assets/js/3.e5de98dd.js"><link rel="prefetch" href="/assets/js/30.a3c8ad7c.js"><link rel="prefetch" href="/assets/js/31.f12ec2bd.js"><link rel="prefetch" href="/assets/js/32.898e7fe5.js"><link rel="prefetch" href="/assets/js/33.78a9e22e.js"><link rel="prefetch" href="/assets/js/34.49ac807f.js"><link rel="prefetch" href="/assets/js/35.96656f8c.js"><link rel="prefetch" href="/assets/js/36.43a95f57.js"><link rel="prefetch" href="/assets/js/37.0b236ba2.js"><link rel="prefetch" href="/assets/js/38.b600f07d.js"><link rel="prefetch" href="/assets/js/39.eae6b14b.js"><link rel="prefetch" href="/assets/js/4.45665f8a.js"><link rel="prefetch" href="/assets/js/40.8d8ae0be.js"><link rel="prefetch" href="/assets/js/41.fd4968d3.js"><link rel="prefetch" href="/assets/js/42.21095c53.js"><link rel="prefetch" href="/assets/js/43.03c95434.js"><link rel="prefetch" href="/assets/js/44.6b6262f1.js"><link rel="prefetch" href="/assets/js/45.4314cbfb.js"><link rel="prefetch" href="/assets/js/46.7b34ac06.js"><link rel="prefetch" href="/assets/js/47.77f430f6.js"><link rel="prefetch" href="/assets/js/48.644ae3fa.js"><link rel="prefetch" href="/assets/js/49.ca6ceb99.js"><link rel="prefetch" href="/assets/js/5.9221cc65.js"><link rel="prefetch" href="/assets/js/50.689771ec.js"><link rel="prefetch" href="/assets/js/52.9e1093d7.js"><link rel="prefetch" href="/assets/js/53.a883c8e5.js"><link rel="prefetch" href="/assets/js/54.0d87f87e.js"><link rel="prefetch" href="/assets/js/6.08529f20.js"><link rel="prefetch" href="/assets/js/7.d6f7c6a1.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9f84806b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YuXing138</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis2.1数据交互.html" class="nav-link">
  redis2.1数据交互
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.0Redis对象.html" class="nav-link">
  redis3.1.0Redis对象
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.1embstr.html" class="nav-link">
  redis3.1.1embstr
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.2dict.html" class="nav-link">
  redis3.1.2dict
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.3hash.html" class="nav-link">
  redis3.1.3hash
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.4skiplist.html" class="nav-link">
  redis3.1.4skiplist
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.1持久化.html" class="nav-link">
  redis4.1持久化
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.2副本.html" class="nav-link">
  redis4.2副本
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.3哨兵.html" class="nav-link">
  redis4.3哨兵
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.4集群.html" class="nav-link">
  redis4.4集群
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Clouder Menu" class="dropdown-title"><span class="title">Clouder</span> <span class="arrow down"></span></button> <button type="button" aria-label="Clouder Menu" class="mobile-dropdown-title"><span class="title">Clouder</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Clouder/Clouder.html" class="nav-link">
  Clouder
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/Clouder源码介绍.html" class="nav-link">
  Clouder源码介绍
</a></li><li class="dropdown-item"><!----> <a href="/Clouder/怎么开源.html" class="nav-link">
  怎么开源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Elasticsearch Menu" class="dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow down"></span></button> <button type="button" aria-label="Elasticsearch Menu" class="mobile-dropdown-title"><span class="title">Elasticsearch</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.1环境安装.html" class="nav-link">
  es1.1环境安装
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.2一些概念.html" class="nav-link">
  es1.2一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.3一些API.html" class="nav-link">
  es1.3一些API
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.4查询.html" class="nav-link">
  es1.4查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.5聚合查询.html" class="nav-link">
  es1.5聚合查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.6ORM.html" class="nav-link">
  es1.6ORM
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.7分析器.html" class="nav-link">
  es1.7分析器
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.8脚本语言.html" class="nav-link">
  es1.8脚本语言
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es1.9搜索建议.html" class="nav-link">
  es1.9搜索建议
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.1高可用性.html" class="nav-link">
  es2.1高可用性
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.2搜索查询.html" class="nav-link">
  es2.2搜索查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.3倒排索引.html" class="nav-link">
  es2.3倒排索引
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.4地理查询.html" class="nav-link">
  es2.4地理查询
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.5一些概念.html" class="nav-link">
  es2.5一些概念
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.6相似性评分.html" class="nav-link">
  es2.6相似性评分
</a></li><li class="dropdown-item"><!----> <a href="/Elasticsearch/es2.7索引.html" class="nav-link">
  es2.7索引
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java面试题 Menu" class="dropdown-title"><span class="title">Java面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java面试题 Menu" class="mobile-dropdown-title"><span class="title">Java面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java面试题/一些面试题.html" class="nav-link">
  一些面试题
</a></li><li class="dropdown-item"><!----> <a href="/Java面试题/面试经典150题.html" class="nav-link">
  面试经典150题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Redis Menu" class="dropdown-title"><span class="title">Redis</span> <span class="arrow down"></span></button> <button type="button" aria-label="Redis Menu" class="mobile-dropdown-title"><span class="title">Redis</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Redis/redis1.1数据类型.html" class="nav-link">
  redis1.1数据类型
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis2.1数据交互.html" class="nav-link">
  redis2.1数据交互
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.0Redis对象.html" class="nav-link">
  redis3.1.0Redis对象
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.1embstr.html" class="nav-link">
  redis3.1.1embstr
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.2dict.html" class="nav-link">
  redis3.1.2dict
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.3hash.html" class="nav-link">
  redis3.1.3hash
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis3.1.4skiplist.html" class="nav-link">
  redis3.1.4skiplist
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.1持久化.html" class="nav-link">
  redis4.1持久化
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.2副本.html" class="nav-link">
  redis4.2副本
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.3哨兵.html" class="nav-link">
  redis4.3哨兵
</a></li><li class="dropdown-item"><!----> <a href="/Redis/redis4.4集群.html" class="nav-link">
  redis4.4集群
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Redis/redis1.1数据类型.html" class="sidebar-link">redis1.1数据类型</a></li><li><a href="/Redis/redis2.1数据交互.html" class="sidebar-link">redis2.1数据交互</a></li><li><a href="/Redis/redis3.1.0Redis对象.html" class="sidebar-link">redis3.1.0Redis对象</a></li><li><a href="/Redis/redis3.1.1embstr.html" class="sidebar-link">redis3.1.1embstr</a></li><li><a href="/Redis/redis3.1.2dict.html" class="sidebar-link">redis3.1.2dict</a></li><li><a href="/Redis/redis3.1.3hash.html" class="sidebar-link">redis3.1.3hash</a></li><li><a href="/Redis/redis3.1.4skiplist.html" class="sidebar-link">redis3.1.4skiplist</a></li><li><a href="/Redis/redis4.1持久化.html" class="active sidebar-link">redis4.1持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#" class="sidebar-link">/</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#持久化-persistence" class="sidebar-link" style="padding-left:3rem;">持久化（Persistence）</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#rdb的优势" class="sidebar-link" style="padding-left:3rem;">RDB的优势</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#rdb的缺点" class="sidebar-link" style="padding-left:3rem;">RDB的缺点</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#aof优势" class="sidebar-link" style="padding-left:3rem;">AOF优势</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#aof的缺点" class="sidebar-link" style="padding-left:3rem;">AOF的缺点</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#好的-那我该用什么" class="sidebar-link" style="padding-left:3rem;">好的，那我该用什么？</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#rdb快照" class="sidebar-link" style="padding-left:4rem;">RDB快照</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#aof仅追加文件" class="sidebar-link" style="padding-left:4rem;">AOF仅追加文件</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#日志重写-重建" class="sidebar-link" style="padding-left:3rem;">日志重写（重建）</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#仅aof追加文件的持久性如何" class="sidebar-link" style="padding-left:4rem;">仅AOF追加文件的持久性如何？</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#如果aof被截断-我该怎么办" class="sidebar-link" style="padding-left:4rem;">如果AOF被截断，我该怎么办？</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#如果aof被破坏了-我该怎么办" class="sidebar-link" style="padding-left:4rem;">如果AOF被破坏了，我该怎么办？</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#它是如何工作的" class="sidebar-link" style="padding-left:4rem;">它是如何工作的</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#aof和rdb持久性之间的交互" class="sidebar-link" style="padding-left:3rem;">AOF和RDB持久性之间的交互</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#备份redis数据" class="sidebar-link" style="padding-left:3rem;">备份Redis数据</a></li><li class="sidebar-sub-header"><a href="/Redis/redis4.1持久化.html#灾难恢复" class="sidebar-link" style="padding-left:3rem;">灾难恢复</a></li></ul></li></ul></li><li><a href="/Redis/redis4.2副本.html" class="sidebar-link">redis4.2副本</a></li><li><a href="/Redis/redis4.3哨兵.html" class="sidebar-link">redis4.3哨兵</a></li><li><a href="/Redis/redis4.4集群.html" class="sidebar-link">redis4.4集群</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id=""><a href="#" class="header-anchor">#</a> /</h2> <blockquote><p><a href="https://redis.io/topics/persistence.html" target="_blank" rel="noopener noreferrer">https://redis.io/topics/persistence.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="持久化-persistence"><a href="#持久化-persistence" class="header-anchor">#</a> 持久化（Persistence）</h4> <p>Redis提供了一系列不同的持久性选项：</p> <ul><li>RDB (Redis Database)：RDB持久性以指定的时间间隔执行数据集的时间点快照。</li> <li>AOF (Append Only File)：AOF持久性记录服务器接收到的每个写入操作，这些操作将在服务器启动时再次播放，重建原始数据集。命令使用与Redis协议本身相同的格式记录，仅以追加方式记录。Redis能够在日志过大时在后台重写日志。</li> <li>No persistence：如果您愿意，您可以完全禁用持久性，如果您希望您的数据在服务器运行期间一直存在。</li> <li>RDB + AOF：可以将AOF和RDB组合在同一个实例中。请注意，在这种情况下，当Redis重新启动时，AOF文件将用于重建原始数据集，因为它保证是最完整的。</li></ul> <p>最重要的是要理解RDB和AOF持久性之间的不同权衡。让我们从RDB开始：</p> <h4 id="rdb的优势"><a href="#rdb的优势" class="header-anchor">#</a> RDB的优势</h4> <ul><li>RDB是Redis数据的一个非常紧凑的单文件时间点表示。RDB文件非常适合备份。例如，您可能希望在最近的24小时内每小时归档一次RDB文件，并在30天内每天保存一个RDB快照。这使您能够在发生灾难时轻松恢复不同版本的数据集。</li> <li>RDB非常适合灾难恢复，它是一个可以传输到远程数据中心或AmazonS3（可能是加密的）的单个紧凑文件。</li> <li>RDB最大限度地提高了Redis的性能，因为Redis父进程要想持久化，唯一需要做的工作就是派生一个子进程来完成其余的工作。父实例永远不会执行磁盘I/O或类似操作。</li> <li>与AOF相比，RDB允许使用大数据集更快地重新启动。</li> <li>在副本上，RDB支持重新启动和故障切换后的部分重新同步。</li></ul> <h4 id="rdb的缺点"><a href="#rdb的缺点" class="header-anchor">#</a> RDB的缺点</h4> <ul><li>如果您需要在Redis停止工作（例如停电后）的情况下最大限度地减少数据丢失的机会，那么RDB是不好的。您可以在生成RDB的位置配置不同的存储点（例如，在至少五分钟后，对数据集进行100次写入，但您可以有多个存储点）。然而，您通常每五分钟或更长时间创建一个RDB快照，因此，如果Redis因任何原因在没有正确关闭的情况下停止工作，您应该做好丢失最新几分钟数据的准备。</li> <li>RDB经常需要分叉（），以便使用子进程在磁盘上持久化。如果数据集很大，Fork（）可能会很耗时，并且可能导致Redis在数据集很大且CPU性能不好的情况下停止为客户端提供服务几毫秒甚至一秒钟。AOF也需要fork（），但您可以调整重写日志的频率，而不需要在耐用性上进行任何权衡。</li></ul> <h4 id="aof优势"><a href="#aof优势" class="header-anchor">#</a> AOF优势</h4> <ul><li>使用AOF Redis要持久得多：您可以有不同的fsync策略：完全不进行fsync、每秒进行fsync和每次查询进行fsync。在fsync的默认策略下，每秒写入性能仍然很好（fsync是使用后台线程执行的，当没有fsync时，主线程会努力执行写入。）但您只能损失一秒钟的写入。</li> <li>AOF日志是一个仅追加的日志，因此在停电时不会出现查找或损坏问题。即使由于某种原因（磁盘已满或其他原因），日志以半写命令结束，redis check aof工具也能很容易地修复它。</li> <li>Redis能够在AOF过大时自动在后台重写AOF。重写是完全安全的，因为当Redis继续追加到旧文件时，会用创建当前数据集所需的最小操作集生成一个全新的文件，一旦第二个文件准备好，Redis就会切换这两个文件并开始追加到新文件。</li> <li>AOF以易于理解和解析的格式包含一个接一个的所有操作的日志。您甚至可以轻松导出AOF文件。例如，即使您意外地使用FLUSHALL命令刷新了所有内容，只要在此期间没有执行日志重写，您仍然可以通过停止服务器、删除最新命令并重新启动Redis来保存数据集。</li></ul> <h4 id="aof的缺点"><a href="#aof的缺点" class="header-anchor">#</a> AOF的缺点</h4> <ul><li>对于同一数据集，AOF文件通常比等效的RDB文件大。</li> <li>根据具体的fsync策略，AOF可能比RDB慢。一般来说，将fsync设置为每秒一次，性能仍然很高，禁用fsync后，即使在高负载下，它也应该与RDB一样快。尽管如此，即使在巨大的写负载的情况下，RDB也能够提供更多关于最大延迟的保证。</li> <li>在过去，我们在特定命令中遇到了罕见的错误（例如，有一个涉及阻塞命令，如BRPOPLPUSH），导致生成的AOF在重新加载时无法完全再现相同的数据集。这些错误很少见，我们在测试套件中进行了测试，自动创建随机的复杂数据集，并重新加载它们以检查一切正常。然而，使用RDB持久性几乎不可能出现这种错误。为了更清楚地说明这一点：Redis AOF通过增量更新现有状态来工作，就像My SQL或Mongo DB一样，而RDB快照一次又一次地从头开始创建一切，这在概念上更健壮。然而，1）需要注意的是，每次Redis重写AOF时，都会从数据集中包含的实际数据开始从头开始重新创建，与总是附加的AOF文件（或者重写后读取旧的AOF而不是读取内存中的数据）相比，这使对错误的抵抗力更强。2） 我们从未收到过用户关于在现实世界中检测到的AOF损坏的任何报告。</li></ul> <h4 id="好的-那我该用什么"><a href="#好的-那我该用什么" class="header-anchor">#</a> 好的，那我该用什么？</h4> <p>一般的指示是，如果您想要与PostgreSQL所能提供的数据安全程度相当的数据安全性，则应该同时使用这两种持久性方法。<br>如果您非常关心您的数据，但在发生灾难时仍能承受几分钟的数据丢失，那么您可以简单地单独使用RDB。<br>有很多用户单独使用AOF，但我们不鼓励这样做，因为不时地使用RDB快照是进行数据库备份、更快地重新启动以及在AOF引擎出现错误的情况下的好主意。</p> <blockquote><p>注意：由于所有这些原因，我们很可能在未来将AOF和RDB统一为一个单一的持久性模型（长期计划）。</p></blockquote> <p>以下部分将详细说明这两个持久性模型。</p> <h5 id="rdb快照"><a href="#rdb快照" class="header-anchor">#</a> RDB快照</h5> <p>默认情况下，Redis将数据集的快照保存在磁盘上一个名为dump.rdb的二进制文件中。如果数据集中至少有M个更改，您可以将Redis配置为每N秒保存一次数据集，也可以手动调用save或BGSAVE命令。<br>例如，如果至少更改了1000个密钥，此配置将使Redis每60秒自动将数据集转储到磁盘：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>save 60 1000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这种策略被称为快照snapshotting。<br>它是如何工作的<br>每当Redis需要将数据集转储到磁盘时，就会发生以下情况：</p> <ul><li>Redis分叉forks。我们现在有一个子进程和一个父进程。</li> <li>孩子开始将数据集写入临时RDB文件。</li> <li>当子级完成了新RDB文件的编写后，它将替换旧的RDB文件。</li></ul> <p>这种方法允许Redis从写时复制语义中受益。</p> <h5 id="aof仅追加文件"><a href="#aof仅追加文件" class="header-anchor">#</a> AOF仅追加文件</h5> <p>快照不是很耐用。如果你运行Redis的计算机停止运行，电源线故障，或者你不小心杀死了-9你的实例，那么写在Redis上的最新数据就会丢失。虽然这对某些应用程序来说可能不是什么大不了的事情，但也有完全持久性的用例，在这些情况下Redis不是一个可行的选择。<br>仅追加文件是Redis的一种替代、完全持久的策略。它在1.1版中提供。<br>您可以在配置文件中打开AOF：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>appendonly yes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>从现在起，每次Redis收到更改数据集的命令（例如SET）时，都会将其附加到AOF中。当您重新启动Redis时，它将重新播放AOF以重建状态。</p> <h4 id="日志重写-重建"><a href="#日志重写-重建" class="header-anchor">#</a> 日志重写（重建）</h4> <p>正如您所猜测的，随着写操作的执行，AOF变得越来越大。例如，如果您将计数器递增100次，那么数据集中的单个键将包含最终值，但AOF中有100个条目。重建当前状态不需要其中的99个条目。<br>因此Redis支持一个有趣的功能：它能够在后台重建AOF，而不会中断对客户端的服务。每当您发出BGREWRITEOF时，Redis都会写入在内存中重建当前数据集所需的最短命令序列。如果您将AOF与Redis 2.2一起使用，则需要不时运行BGREWRITEAOF。Redis 2.4能够自动触发日志重写（更多信息请参见2.4示例配置文件）。</p> <h5 id="仅aof追加文件的持久性如何"><a href="#仅aof追加文件的持久性如何" class="header-anchor">#</a> 仅AOF追加文件的持久性如何？</h5> <p>您可以配置Redis在磁盘上fsync数据的次数。有三种选择：</p> <ul><li>appendfsync-always：每次将新命令附加到AOF时进行fsync。非常非常慢，非常安全。请注意，在执行来自多个客户端或管道的一批命令后，这些命令将被附加到AOF，因此这意味着一次写入和一次fsync（在发送回复之前）。</li> <li>appendfsync everysec：fsync每秒钟一次。足够快（在2.4中可能与快照一样快），如果发生灾难，您可能会丢失1秒的数据。</li> <li>appendfsync no：永远不要进行fsync，只需将数据交给操作系统即可。更快、更不安全的方法。在这种配置下，Linux通常每30秒就会刷新一次数据，但这取决于内核的精确调整。</li></ul> <p>建议的（也是默认的）策略是每秒进行一次fsync。它既很快又很安全。在实践中，always策略非常慢，但它支持组提交，因此如果有多个并行写入，Redis将尝试执行单个fsync操作。</p> <h5 id="如果aof被截断-我该怎么办"><a href="#如果aof被截断-我该怎么办" class="header-anchor">#</a> 如果AOF被截断，我该怎么办？</h5> <blockquote><p>概括：新版本只会丢掉最后一个格式不正确的命令。</p></blockquote> <p>可能是服务器在写入AOF文件时崩溃，或者存储AOF文件的卷在写入时已满。当这种情况发生时，AOF仍然包含表示数据集的给定时间点版本的一致数据（使用默认的AOF fsync策略，该数据集可能会旧到1秒），但AOF中的最后一个命令可能会被截断。Redis的最新主要版本无论如何都可以加载AOF，只需丢弃文件中最后一个格式不正确的命令。在这种情况下，服务器将发出如下日志：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>* Reading RDB preamble from AOF file...
* Reading the remaining AOF tail...
# !!! Warning: short read while loading the AOF file !!!
# !!! Truncating the AOF at offset 439 !!!
# AOF loaded anyway because aof-load-truncated is enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果您愿意，可以更改默认配置以强制Redis在这种情况下停止，但默认配置是继续，无论文件中的最后一个命令格式是否正确，以确保重新启动后的可用性。<br>较旧版本的Redis可能无法恢复，可能需要以下步骤：</p> <ul><li>制作AOF文件的备份副本。</li> <li>使用redis附带的<code>redis-check-aof</code>工具修复原始文件：$ redis-check-aof --fix</li> <li>可以选择使用<code>diff -u</code>来检查两个文件之间的区别。</li> <li>使用固定fixed的文件重新启动服务器。</li></ul> <h5 id="如果aof被破坏了-我该怎么办"><a href="#如果aof被破坏了-我该怎么办" class="header-anchor">#</a> 如果AOF被破坏了，我该怎么办？</h5> <p>如果AOF文件不仅被截断，而且被中间的无效字节序列破坏，情况就会更复杂。Redis将在启动时抱怨complain并中止：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>* Reading the remaining AOF tail...
# Bad file format reading the append only file: make a backup of your AOF file, then use ./redis-check-aof --fix &lt;filename&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>最好的方法是运行<code>redis-check-aof</code>实用程序，最初不使用--fix选项，然后了解问题，在文件中的给定偏移处跳转，看看是否可以手动修复文件：aof使用与redis协议相同的格式，手动修复非常简单。否则，可以让实用程序为我们修复文件，但在这种情况下，从无效部分到文件末尾的所有AOF部分都可能被丢弃，如果损坏发生在文件的初始部分，则会导致大量数据丢失。</p> <h5 id="它是如何工作的"><a href="#它是如何工作的" class="header-anchor">#</a> 它是如何工作的</h5> <p>日志重写使用了与快照已使用的写时复制<code>copy-on-write</code>相同的技巧。它是这样工作的：</p> <ul><li>Redis分叉forks，所以现在我们有一个子进程和一个父进程。</li> <li>子级开始在临时文件<code>temporary file</code>中写入新的AOF。</li> <li>父级将所有新更改累积在内存缓冲区<code>in-memory buffer</code>中（但同时将新更改写入旧的<code>append-only file</code>中，因此如果重写失败，我们是安全的）。</li> <li>当子级完成对文件的重写时，父级会得到一个信号，并将内存中的缓冲区<code>in-memory buffer</code>附加到子级生成的文件的末尾。</li> <li>现在Redis将旧文件自动重命名为新文件，并开始将新数据附加到新文件中。</li></ul> <blockquote><p>注意：子进程把当前命令写入一个临时AOF文件，父进程将最新命令累积在内存缓冲区。在子进程完成写入后，父进程把最新命令也追加到这个临时AOF文件中，并将临时AOF文件作为新的AOF文件。（在子进程rewrite过程中，父进程不仅把最新命令累积到内存缓冲区，还会追加到当前AOF文件中，直到子进程rewrite完成。）</p></blockquote> <h4 id="aof和rdb持久性之间的交互"><a href="#aof和rdb持久性之间的交互" class="header-anchor">#</a> AOF和RDB持久性之间的交互</h4> <p>Redis&gt;=2.4确保避免在RDB快照操作已经在进行时触发AOF重写，或在AOF重写进行时允许BGSAVE。这样可以防止两个Redis后台进程同时进行繁重的磁盘I/O。<br>当快照处理正在进行，并且用户使用BGREWRITEAOF明确请求日志重写操作时，服务器将回复一个OK状态代码，告诉用户该操作已排定，并且在快照处理完成后将开始重写。<br>在启用AOF和RDB持久性并且Redis重新启动的情况下，AOF文件将用于重建原始数据集，因为它保证是最完整的。</p> <h4 id="备份redis数据"><a href="#备份redis数据" class="header-anchor">#</a> 备份Redis数据</h4> <p>在开始本节之前，请确保阅读以下句子：确保备份数据库。磁盘坏了，云中的实例消失了，等等：没有备份意味着数据消失在/dev/null中的巨大风险。<br>Redis对数据备份非常友好，因为您可以在数据库运行时复制RDB文件：一旦生成RDB，它就永远不会被修改，而在生成时，它使用一个临时名称，并仅在新快照完成时使用rename(2) 原子化地重命名到其最终目的地。<br>这意味着在服务器运行时复制RDB文件是完全安全的。这就是我们的建议：</p> <ul><li>在服务器中创建一个cron作业，在一个目录中创建RDB文件的每小时快照，并在不同的目录中创建每日快照。</li> <li>每次运行cron脚本时，请确保调用find命令以确保删除太旧的快照：例如，您可以拍摄最近48小时的每小时快照，以及一到两个月的每日快照。请确保使用数据和时间信息命名快照。</li> <li>每天至少一次，确保将RDB快照传输到数据中心之外，或者至少传输到运行Redis实例的物理机器之外。</li></ul> <p>如果您运行的Redis实例只启用了AOF持久性，您仍然可以复制AOF以创建备份。该文件可能缺少最后一部分，但Redis仍然可以加载它（请参阅前面关于截断AOF文件的部分）。</p> <h4 id="灾难恢复"><a href="#灾难恢复" class="header-anchor">#</a> 灾难恢复</h4> <p>Redis环境下的灾难恢复与备份基本相同，而且能够在许多不同的外部数据中心传输这些备份。这样，即使在某些灾难性事件影响Redis运行和生成快照的主数据中心的情况下，数据也能得到保护。<br>由于许多Redis用户都处于启动阶段，因此没有足够的钱花，我们将回顾最有趣的灾难恢复技术，这些技术的成本不会太高。</p> <ul><li>AmazonS3和其他类似的服务是实现灾难恢复系统的好方法。只需将您的每日或每小时RDB快照以加密的形式传输到S3。您可以使用<code>gpg -c</code>（对称加密模式）加密数据。确保将您的密码存储在许多不同的安全位置（例如，将一份副本交给组织中最重要的人员）。建议使用多个存储服务以提高数据安全性。</li> <li>使用SCP（SSH的一部分）将快照传输到远程服务器。这是一个相当简单和安全的途径：在离你很远的地方获得一个小型VPS，在那里安装ssh，并生成一个不带密码的ssh客户端密钥，然后将其添加到小型VPS的authorized_keys文件中。您已准备好以自动方式传输备份。在两个不同的提供商中获得至少两个VPS以获得最佳结果。</li></ul> <p>重要的是要明白，如果不以正确的方式实施，这个系统很容易失败。至少要绝对确保在传输完成后，您能够验证文件大小（应该与您复制的文件相匹配），如果您使用的是VPS，还可能验证SHA1摘要。<br>如果由于某种原因新备份的传输不起作用，您还需要某种独立的警报系统。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Redis/redis3.1.4skiplist.html" class="prev">
        redis3.1.4skiplist
      </a></span> <span class="next"><a href="/Redis/redis4.2副本.html">
        redis4.2副本
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0aa5cc29.js" defer></script><script src="/assets/js/2.ae7b2f73.js" defer></script><script src="/assets/js/1.5784faf9.js" defer></script><script src="/assets/js/51.5b9684cc.js" defer></script>
  </body>
</html>
